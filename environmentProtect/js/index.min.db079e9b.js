var designwhScale=320/460,curwhScale=document.documentElement.clientWidth/document.documentElement.clientHeight,resizes=document.querySelectorAll(".resize"),swiperContainer=document.querySelector(".container"),containerWidth=320,containerHeight=504,containerTop=0,containerLeft=0,scale;curwhScale<designwhScale?(containerWidth=document.documentElement.clientWidth,containerHeight=document.documentElement.clientHeight,containerTop=(document.documentElement.clientHeight-containerHeight)/2):(containerWidth=document.documentElement.clientHeight*designwhScale,containerHeight=document.documentElement.clientHeight,containerLeft=(document.documentElement.clientWidth-containerWidth)/2),scale=containerWidth/320,swiperContainer.style.width=containerWidth+"px",swiperContainer.style.height=containerHeight+"px",swiperContainer.style.left=containerLeft+"px",swiperContainer.style.top=containerTop+"px";for(var j=0;j<resizes.length;j++)resizes[j].style.width=parseInt(resizes[j].style.width)*scale+"px",resizes[j].style.height=parseInt(resizes[j].style.height)*scale+"px",resizes[j].style.left=parseInt(resizes[j].style.left)*scale+"px",resizes[j].style.top=parseInt(resizes[j].style.top)*scale+"px",resizes[j].style.bottom=parseInt(resizes[j].style.bottom)*scale+"px",resizes[j].style.right=parseInt(resizes[j].style.right)*scale+"px",resizes[j].style.fontSize=parseInt(resizes[j].style.fontSize)*scale+"px",resizes[j].style.lineHeight=parseInt(resizes[j].style.lineHeight)*scale+"px";!function(a,b){"function"==typeof define&&(define.amd||define.cmd)?define(function(){return b(a)}):b(a,!0)}(this,function(a,b){function c(b,c,d){a.WeixinJSBridge?WeixinJSBridge.invoke(b,e(c),function(a){g(b,a,d)}):j(b,d)}function d(b,c,d){a.WeixinJSBridge?WeixinJSBridge.on(b,function(a){d&&d.trigger&&d.trigger(a),g(b,a,c)}):d?j(b,d):j(b,c)}function e(a){return a=a||{},a.appId=E.appId,a.verifyAppId=E.appId,a.verifySignType="sha1",a.verifyTimestamp=E.timestamp+"",a.verifyNonceStr=E.nonceStr,a.verifySignature=E.signature,a}function f(a){return{timeStamp:a.timestamp+"",nonceStr:a.nonceStr,"package":a["package"],paySign:a.paySign,signType:a.signType||"SHA1"}}function g(a,b,c){var d,e;switch(delete b.err_code,delete b.err_desc,delete b.err_detail,d=b.errMsg,d||(d=b.err_msg,delete b.err_msg,d=h(a,d),b.errMsg=d),c=c||{},c._complete&&(c._complete(b),delete c._complete),d=b.errMsg||"",E.debug&&!c.isInnerInvoke&&alert(JSON.stringify(b)),e=d.indexOf(":"),d.substring(e+1)){case"ok":c.success&&c.success(b);break;case"cancel":c.cancel&&c.cancel(b);break;default:c.fail&&c.fail(b)}c.complete&&c.complete(b)}function h(a,b){var c,d,e=a,f=p[e];return f&&(e=f),c="ok",b&&(d=b.indexOf(":"),c=b.substring(d+1),"confirm"==c&&(c="ok"),"failed"==c&&(c="fail"),-1!=c.indexOf("failed_")&&(c=c.substring(7)),-1!=c.indexOf("fail_")&&(c=c.substring(5)),c=c.replace(/_/g," "),c=c.toLowerCase(),("access denied"==c||"no permission to execute"==c)&&(c="permission denied"),"config"==e&&"function not exist"==c&&(c="ok"),""==c&&(c="fail")),b=e+":"+c}function i(a){var b,c,d,e;if(a){for(b=0,c=a.length;c>b;++b)d=a[b],(e=o[d])&&(a[b]=e);return a}}function j(a,b){if(!(!E.debug||b&&b.isInnerInvoke)){var c=p[a];c&&(a=c),b&&b._complete&&delete b._complete,console.log('"'+a+'",',b||"")}}function k(){0!=D.preVerifyState&&(u||v||E.debug||"6.0.2">z||D.systemType<0||A||(A=!0,D.appId=E.appId,D.initTime=C.initEndTime-C.initStartTime,D.preVerifyTime=C.preVerifyEndTime-C.preVerifyStartTime,H.getNetworkType({isInnerInvoke:!0,success:function(a){var b,c;D.networkType=a.networkType,b="http://open.weixin.qq.com/sdk/report?v="+D.version+"&o="+D.preVerifyState+"&s="+D.systemType+"&c="+D.clientVersion+"&a="+D.appId+"&n="+D.networkType+"&i="+D.initTime+"&p="+D.preVerifyTime+"&u="+D.url,c=new Image,c.src=b}})))}function l(){return(new Date).getTime()}function m(b){w&&(a.WeixinJSBridge?b():q.addEventListener&&q.addEventListener("WeixinJSBridgeReady",b,!1))}function n(){H.invoke||(H.invoke=function(b,c,d){a.WeixinJSBridge&&WeixinJSBridge.invoke(b,e(c),d)},H.on=function(b,c){a.WeixinJSBridge&&WeixinJSBridge.on(b,c)})}var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;if(!a.jWeixin)return o={config:"preVerifyJSAPI",onMenuShareTimeline:"menu:share:timeline",onMenuShareAppMessage:"menu:share:appmessage",onMenuShareQQ:"menu:share:qq",onMenuShareWeibo:"menu:share:weiboApp",onMenuShareQZone:"menu:share:QZone",previewImage:"imagePreview",getLocation:"geoLocation",openProductSpecificView:"openProductViewWithPid",addCard:"batchAddCard",openCard:"batchViewCard",chooseWXPay:"getBrandWCPayRequest"},p=function(){var a,b={};for(a in o)b[o[a]]=a;return b}(),q=a.document,r=q.title,s=navigator.userAgent.toLowerCase(),t=navigator.platform.toLowerCase(),u=!(!t.match("mac")&&!t.match("win")),v=-1!=s.indexOf("wxdebugger"),w=-1!=s.indexOf("micromessenger"),x=-1!=s.indexOf("android"),y=-1!=s.indexOf("iphone")||-1!=s.indexOf("ipad"),z=function(){var a=s.match(/micromessenger\/(\d+\.\d+\.\d+)/)||s.match(/micromessenger\/(\d+\.\d+)/);return a?a[1]:""}(),A=!1,B=!1,C={initStartTime:l(),initEndTime:0,preVerifyStartTime:0,preVerifyEndTime:0},D={version:1,appId:"",initTime:0,preVerifyTime:0,networkType:"",preVerifyState:1,systemType:y?1:x?2:-1,clientVersion:z,url:encodeURIComponent(location.href)},E={},F={_completes:[]},G={state:0,data:{}},m(function(){C.initEndTime=l()}),H={config:function(a){E=a,j("config",a);var b=!1!==E.check;m(function(){var a,d,e;if(b)c(o.config,{verifyJsApiList:i(E.jsApiList)},function(){F._complete=function(a){C.preVerifyEndTime=l(),G.state=1,G.data=a},F.success=function(){D.preVerifyState=0},F.fail=function(a){F._fail?F._fail(a):G.state=-1};var a=F._completes;return a.push(function(){k()}),F.complete=function(){for(var b=0,c=a.length;c>b;++b)a[b]();F._completes=[]},F}()),C.preVerifyStartTime=l();else{for(G.state=1,a=F._completes,d=0,e=a.length;e>d;++d)a[d]();F._completes=[]}}),E.beta&&n()},ready:function(a){0!=G.state?a():(F._completes.push(a),!w&&E.debug&&a())},error:function(a){"6.0.2">z||B||(B=!0,-1==G.state?a(G.data):F._fail=a)},checkJsApi:function(a){var b=function(a){var b,c,d=a.checkResult;for(b in d)(c=p[b])&&(d[c]=d[b],delete d[b]);return a};c("checkJsApi",{jsApiList:i(a.jsApiList)},function(){return a._complete=function(a){if(x){var c=a.checkResult;c&&(a.checkResult=JSON.parse(c))}a=b(a)},a}())},onMenuShareTimeline:function(a){d(o.onMenuShareTimeline,{complete:function(){c("shareTimeline",{title:a.title||r,desc:a.title||r,img_url:a.imgUrl||"",link:a.link||location.href,type:a.type||"link",data_url:a.dataUrl||""},a)}},a)},onMenuShareAppMessage:function(a){d(o.onMenuShareAppMessage,{complete:function(){c("sendAppMessage",{title:a.title||r,desc:a.desc||"",link:a.link||location.href,img_url:a.imgUrl||"",type:a.type||"link",data_url:a.dataUrl||""},a)}},a)},onMenuShareQQ:function(a){d(o.onMenuShareQQ,{complete:function(){c("shareQQ",{title:a.title||r,desc:a.desc||"",img_url:a.imgUrl||"",link:a.link||location.href},a)}},a)},onMenuShareWeibo:function(a){d(o.onMenuShareWeibo,{complete:function(){c("shareWeiboApp",{title:a.title||r,desc:a.desc||"",img_url:a.imgUrl||"",link:a.link||location.href},a)}},a)},onMenuShareQZone:function(a){d(o.onMenuShareQZone,{complete:function(){c("shareQZone",{title:a.title||r,desc:a.desc||"",img_url:a.imgUrl||"",link:a.link||location.href},a)}},a)},startRecord:function(a){c("startRecord",{},a)},stopRecord:function(a){c("stopRecord",{},a)},onVoiceRecordEnd:function(a){d("onVoiceRecordEnd",a)},playVoice:function(a){c("playVoice",{localId:a.localId},a)},pauseVoice:function(a){c("pauseVoice",{localId:a.localId},a)},stopVoice:function(a){c("stopVoice",{localId:a.localId},a)},onVoicePlayEnd:function(a){d("onVoicePlayEnd",a)},uploadVoice:function(a){c("uploadVoice",{localId:a.localId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},downloadVoice:function(a){c("downloadVoice",{serverId:a.serverId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},translateVoice:function(a){c("translateVoice",{localId:a.localId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},chooseImage:function(a){c("chooseImage",{scene:"1|2",count:a.count||9,sizeType:a.sizeType||["original","compressed"],sourceType:a.sourceType||["album","camera"]},function(){return a._complete=function(a){if(x){var b=a.localIds;b&&(a.localIds=JSON.parse(b))}},a}())},previewImage:function(a){c(o.previewImage,{current:a.current,urls:a.urls},a)},uploadImage:function(a){c("uploadImage",{localId:a.localId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},downloadImage:function(a){c("downloadImage",{serverId:a.serverId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},getNetworkType:function(a){var b=function(a){var b,c,d,e=a.errMsg;if(a.errMsg="getNetworkType:ok",b=a.subtype,delete a.subtype,b)a.networkType=b;else switch(c=e.indexOf(":"),d=e.substring(c+1)){case"wifi":case"edge":case"wwan":a.networkType=d;break;default:a.errMsg="getNetworkType:fail"}return a};c("getNetworkType",{},function(){return a._complete=function(a){a=b(a)},a}())},openLocation:function(a){c("openLocation",{latitude:a.latitude,longitude:a.longitude,name:a.name||"",address:a.address||"",scale:a.scale||28,infoUrl:a.infoUrl||""},a)},getLocation:function(a){a=a||{},c(o.getLocation,{type:a.type||"wgs84"},function(){return a._complete=function(a){delete a.type},a}())},hideOptionMenu:function(a){c("hideOptionMenu",{},a)},showOptionMenu:function(a){c("showOptionMenu",{},a)},closeWindow:function(a){a=a||{},c("closeWindow",{},a)},hideMenuItems:function(a){c("hideMenuItems",{menuList:a.menuList},a)},showMenuItems:function(a){c("showMenuItems",{menuList:a.menuList},a)},hideAllNonBaseMenuItem:function(a){c("hideAllNonBaseMenuItem",{},a)},showAllNonBaseMenuItem:function(a){c("showAllNonBaseMenuItem",{},a)},scanQRCode:function(a){a=a||{},c("scanQRCode",{needResult:a.needResult||0,scanType:a.scanType||["qrCode","barCode"]},function(){return a._complete=function(a){var b,c;y&&(b=a.resultStr)&&(c=JSON.parse(b),a.resultStr=c&&c.scan_code&&c.scan_code.scan_result)},a}())},openProductSpecificView:function(a){c(o.openProductSpecificView,{pid:a.productId,view_type:a.viewType||0,ext_info:a.extInfo},a)},addCard:function(a){var b,d,e,f,g=a.cardList,h=[];for(b=0,d=g.length;d>b;++b)e=g[b],f={card_id:e.cardId,card_ext:e.cardExt},h.push(f);c(o.addCard,{card_list:h},function(){return a._complete=function(a){var b,c,d,e=a.card_list;if(e){for(e=JSON.parse(e),b=0,c=e.length;c>b;++b)d=e[b],d.cardId=d.card_id,d.cardExt=d.card_ext,d.isSuccess=!!d.is_succ,delete d.card_id,delete d.card_ext,delete d.is_succ;a.cardList=e,delete a.card_list}},a}())},chooseCard:function(a){c("chooseCard",{app_id:E.appId,location_id:a.shopId||"",sign_type:a.signType||"SHA1",card_id:a.cardId||"",card_type:a.cardType||"",card_sign:a.cardSign,time_stamp:a.timestamp+"",nonce_str:a.nonceStr},function(){return a._complete=function(a){a.cardList=a.choose_card_info,delete a.choose_card_info},a}())},openCard:function(a){var b,d,e,f,g=a.cardList,h=[];for(b=0,d=g.length;d>b;++b)e=g[b],f={card_id:e.cardId,code:e.code},h.push(f);c(o.openCard,{card_list:h},a)},chooseWXPay:function(a){c(o.chooseWXPay,f(a),a)}},b&&(a.wx=a.jWeixin=H),H}),function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.resLoader=b()}(this,function(){function a(a){if(this.option={resourceType:"image",baseUrl:"./",resources:[],onStart:null,onProgress:null,onComplete:null},!a)return void alert("参数错误！");for(i in a)this.option[i]=a[i];this.status=0,this.total=this.option.resources.length||0,this.currentIndex=0}var b=function(a){return"function"==typeof a};return a.prototype.start=function(){this.status=1;for(var a=this,c=this.option.baseUrl,d=0,e=this.option.resources.length;d<e;d++){var f=this.option.resources[d],g="";g=0===f.indexOf("http://")||0===f.indexOf("https://")?f:c+f;var h=new Image;h.onload=function(){a.loaded()},h.onerror=function(){a.loaded()},h.src=g}b(this.option.onStart)&&this.option.onStart(this.total)},a.prototype.loaded=function(a){b(this.option.onProgress)&&this.option.onProgress(++this.currentIndex,this.total,a),this.currentIndex===this.total&&b(this.option.onComplete)&&this.option.onComplete(this.total)},a}),$(function(){function a(b){var c=b.accelerationIncludingGravity,d=(new Date).getTime(),e=d-w;if(e>100){w=d,q=c.x,r=c.y,s=c.z;Math.abs(q+r+s-t-u-x)/e*1e4>v&&o&&(o=!1,$(".water-save2,.valve").show(),document.querySelector(".water-save2").play(),document.querySelector(".water-save1").stop(),window.removeEventListener("devicemotion",a,!1)),t=q,u=r,x=s}}function b(a){var c=(new Date).getTime();c-B>100&&(B=c,y=a.gamma,A++,A>1&&(C=y-z)>10&&($(".frame1-bf").hide(),$(".incline").show(),setTimeout(function(){$(".incline").hide(),$(".frame2-bf").addClass("active"),$(".bottle-cap").show()},1500),window.removeEventListener("deviceorientation",b),C=0),z=y)}function c(a,b){m=!0,g.src=a,h.style.display="block",g.loop=b}function d(){g.src="",m=!1,h.style.display="none"}function e(){if(l){if(p>1)return d(),g.removeEventListener("ended",e),void(g.loop=!0);p++,g.play()}}function f(c){for(var d=document.getElementsByTagName("img"),e=[],h=0;h<d.length;h++)d[h].getAttribute("page")==c&&e.push(d[h]);for(var i=[],j=[],k=0;k<e.length;k++){var l=e[k].getAttribute("pre-src");l&&(i.push(l),j.push(e[k]))}new resLoader({resources:i,onStart:function(a){},onProgress:function(a,b){},onComplete:function(d){for(var e=0;e<j.length;e++)i[e].indexOf("?t=")>-1?j[e].setAttribute("src",i[e]+Math.random()):j[e].setAttribute("src",i[e]);1==c&&($(".container").show(),$(".load").hide(),$(".frame1-bf").removeClass("active"),window&&window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",b,!1),window&&window.DeviceMotionEvent&&window.addEventListener("devicemotion",a,!1),g.src="media/one.mp3",g.loop=!0),f(++c)}}).start()}var g=document.getElementById("audio"),h=document.querySelector(".music-btn"),i="我不想站在世界中心呼唤爱，我只愿每次的呼唤都能点亮最美的你",j=window.location.href,k=location.origin+"/FE/activity/environmental/images/link.jpg",l=!0,m=!0;$.ajax({url:location.origin+"/wechat/getJsSdkSign",type:"post",headers:{appId:"mallapi.bluemoon.com.cn"===location.host?"wx80b56cff67cdb9b6":"wx0f1ec6aca9f0c01e"},data:JSON.stringify({url:window.location.href.split("#")[0]}),contentType:"application/json",success:function(a){wx.config({appId:a.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]})}}),wx.ready(function(){g.play(),wx.onMenuShareAppMessage({title:"这一切有你而美好",desc:i,link:j,imgUrl:k}),wx.onMenuShareTimeline({title:"这一切有你而美好",desc:i,link:j,imgUrl:k}),wx.onMenuShareQQ({title:"这一切有你而美好",desc:i,link:j,imgUrl:k})}),function(){var a=function(){g.pause()},b=function(){m?l?(g.play(),h.setAttribute("src","images/music-open.png")):(g.pause(),h.setAttribute("src","images/music-close.png")):h.style.display="none"},c=function(){document[d]?a():b()};window.addEventListener("focus",b,!1),window.addEventListener("blur",a,!1);var d,e;"undefined"!=typeof document.hidden?(d="hidden",e="visibilitychange"):"undefined"!=typeof document.mozHidden?(d="mozHidden",e="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(d="msHidden",e="msvisibilitychange"):"undefined"!=typeof document.webkitHidden?(d="webkitHidden",e="webkitvisibilitychange"):"undefined"!=typeof document.oHidden&&(d="oHidden",e="ovisibilitychange"),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pageshow",b,!1),window.addEventListener("pagehide",a,!1)),d&&e&&document.addEventListener(e,c,!1)}(),h.addEventListener("click",function(a){g.paused?(g.play(),l=!0,h.setAttribute("src","images/music-open.png")):(g.pause(),l=!1,h.setAttribute("src","images/music-close.png")),a.preventDefault()}),f(1),$(".first-way").click(function(){return $(".first-mask").show(),$(".fish1,.fish2").addClass("active"),!1}),$(".page-one .tip-action").click(function(){return $(".page-one .tip-way-content").html("右倾手机&nbsp;&nbsp;点击瓶盖"),!1}),$(".first-mask").click(function(){$(".page-one .tip-way-content").html("平平顺顺&nbsp;&nbsp;无碍无阻"),$(".first-mask").hide(),$(".fish1,.fish2").removeClass("active")}),$(".noClose").click(function(){return!1});var n;$(".bottle-cap").click(function(){$(this).hide(),$(".page-one .grey").removeClass("active"),$(".frame2-bf").removeClass("active"),$(".frame3-bf").addClass("active"),n=setTimeout(function(){d()},4500)});var o=!1,p=1;$(".first-next").click(function(){clearTimeout(n),$(".page-one .grey").hasClass("active")||(c("media/two.mp3",!1),g.addEventListener("ended",e),l?g.play():g.pause(),$(".page-one").hide(),$(".page-two").show(),document.querySelector(".water-save1").play(),o=!0,$(".frame1-bf").show(),$(".page-one .grey").addClass("active"),$(".frame3-bf").removeClass("active"))}),$(".second-way").click(function(){$(".second-mask").show(),$(".flower1,.flower2").addClass("active")}),$(".page-two .tip-action").click(function(){return $(".page-two .tip-way-content").html("摇动手机&nbsp;&nbsp;关闭阀门"),!1}),$(".second-mask").click(function(){$(".page-two .tip-way-content").html("摇动生风&nbsp;&nbsp;润泽常在"),$(".second-mask").hide(),$(".flower1,.flower2").removeClass("active")}),$(".valve").click(function(){$(this).hide(),$(".water-save3").show(),document.querySelector(".water-save3").play(),document.querySelector(".water-save2").stop(),$(".page-two .grey").removeClass("active"),g.removeEventListener("ended",e)}),$(".second-next").click(function(){$(".page-two .grey").hasClass("active")||($(".page-two").hide(),$(".page-three").show(),c("media/three.mp3",!0),l?g.play():g.pause(),p=1,$(".water-save2,.water-save3").hide(),$(".page-two .grey").addClass("active"),document.querySelector(".water-save3").stop())}),$(".third-way").click(function(){return $(".third-mask").show(),$(".bird1,.bird2").addClass("active"),!1}),$(".page-three .tip-action").click(function(){return $(".page-three .tip-way-content").html("拨开乌云&nbsp;&nbsp;关闭开关"),!1}),$(".third-mask").click(function(){$(".page-three .tip-way-content").html("拨云去雾&nbsp;&nbsp;清新自来"),$(".third-mask").hide(),$(".bird1,.bird2").removeClass("active")}),$(".cloudFly").on("touchstart click",function(){return $(".cloud1,.cloud3,.cloud4").addClass("active"),$(".cloudFly").hide(),!1}),$(".light-open").click(function(){$(this).hide(),$(".light-close,.cloud2,.fly").addClass("active"),$(".save-power2").show(),document.querySelector(".save-power2").play(),$(".page-three .grey").removeClass("active"),setTimeout(function(){d()},2500)}),$(".third-next").click(function(){$(".page-three .grey").hasClass("active")||($(".page-three").hide(),$(".page-four").show(),d(),$(".cloud1,.cloud3,.cloud4").removeClass("active"),$(".light-open,.cloudFly").show(),$(".light-close,.cloud2,.fly").removeClass("active"),$(".save-power2").hide(),$(".page-three .grey").addClass("active"),document.querySelector(".save-power2").stop())}),$(".again").click(function(){y=0,z=0,A=0,B=0,x=0,$(".page-one").show(),$(".page-four").hide(),c("media/one.mp3",!0),h.setAttribute("src","images/music-open.png"),l=!0,window.addEventListener("deviceorientation",b,!1),window.addEventListener("devicemotion",a,!1)}),$(".share").click(function(){$(".fourth-mask").show()}),$(".fourth-mask").click(function(){$(this).hide()});var q,r,s,t,u,v=3e3,w=0,x=0,y=0,z=0,A=0,B=0,C=0;"getContext"in document.createElement("canvas")&&(HTMLImageElement.prototype.play=function(){this.storeCanvas&&(this.storeCanvas.parentElement.removeChild(this.storeCanvas),this.storeCanvas=null,image.style.opacity=""),this.storeUrl&&(this.src=this.storeUrl)},HTMLImageElement.prototype.stop=function(){var a=document.createElement("canvas"),b=this.width,c=this.height;if(b&&c){this.storeUrl||(this.storeUrl=this.src),a.width=b,a.height=c,a.getContext("2d").drawImage(this,0,0,b,c);try{this.src=a.toDataURL("image/gif")}catch(d){this.removeAttribute("src"),a.style.position="absolute",this.parentElement.insertBefore(a,this),this.style.opacity="0",this.storeCanvas=a}}})});